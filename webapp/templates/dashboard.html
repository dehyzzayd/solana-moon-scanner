{% extends "base.html" %}

{% block content %}
<div x-data="dashboardData()" x-init="init()">
    <!-- Auto Scanner Status Banner -->
    <div class="mb-6 rounded-lg shadow-lg p-4" :class="autoScannerStatus.running ? 'bg-gradient-to-r from-purple-800 to-blue-800' : 'bg-gray-800'">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="flex-shrink-0">
                    <i class="fas fa-robot text-3xl" :class="autoScannerStatus.running ? 'text-purple-300' : 'text-gray-500'"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white">Auto Scanner</h3>
                    <p class="text-sm" :class="autoScannerStatus.running ? 'text-purple-200' : 'text-gray-400'">
                        <span x-show="autoScannerStatus.running">
                            🟢 Active - Scanning every 5 minutes | 
                            Discovered: <span x-text="autoScannerStatus.discovered_tokens"></span> | 
                            Scanned: <span x-text="autoScannerStatus.scanned_tokens"></span>
                        </span>
                        <span x-show="!autoScannerStatus.running">
                            🔴 Inactive - Auto scanning is disabled
                        </span>
                    </p>
                </div>
            </div>
            <div>
                <button @click="toggleAutoScanner()" 
                        class="px-4 py-2 rounded-lg font-semibold transition-colors"
                        :class="autoScannerStatus.running ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white'">
                    <i class="fas" :class="autoScannerStatus.running ? 'fa-stop' : 'fa-play'"></i>
                    <span x-text="autoScannerStatus.running ? 'Stop' : 'Start'"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Scan Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Manual Token Address Scan -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-white mb-4">
                <i class="fas fa-search mr-2"></i>
                Scan Token Address
            </h3>
            <p class="text-sm text-gray-400 mb-4">Enter a Solana token address to get detailed analysis</p>
            <div class="flex gap-2">
                <input type="text" 
                       x-model="manualTokenAddress"
                       @keyup.enter="scanManualToken()"
                       placeholder="Enter token address (e.g., 2kQXaTMyf6tojju...)"
                       class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button @click="scanManualToken()" 
                        :disabled="!manualTokenAddress || scanningToken"
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors">
                    <i class="fas" :class="scanningToken ? 'fa-spinner fa-spin' : 'fa-search'"></i>
                    <span x-text="scanningToken ? 'Scanning...' : 'Scan'"></span>
                </button>
            </div>
        </div>

        <!-- Manual Discovery Scan -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-white mb-4">
                <i class="fas fa-clock-rotate-left mr-2"></i>
                Discover Recent Tokens
            </h3>
            <p class="text-sm text-gray-400 mb-4">Manually trigger discovery of tokens released in the last 2-3 hours</p>
            <div class="flex gap-2">
                <select x-model="manualScanHours" 
                        class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="1">Last 1 hour</option>
                    <option value="2" selected>Last 2 hours</option>
                    <option value="3">Last 3 hours</option>
                    <option value="6">Last 6 hours</option>
                </select>
                <button @click="triggerManualDiscovery()" 
                        :disabled="scanningDiscovery"
                        class="flex-1 px-6 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors">
                    <i class="fas" :class="scanningDiscovery ? 'fa-spinner fa-spin' : 'fa-radar'"></i>
                    <span x-text="scanningDiscovery ? 'Discovering...' : 'Discover & Scan'"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
        <!-- Total Scans -->
        <div class="overflow-hidden rounded-lg bg-gray-800 px-4 py-5 shadow sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">Total Scans</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-white" x-text="stats.total_scans"></dd>
        </div>

        <!-- Average Score -->
        <div class="overflow-hidden rounded-lg bg-gray-800 px-4 py-5 shadow sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">Average Score</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-white" x-text="stats.average_score"></dd>
        </div>

        <!-- High Scores -->
        <div class="overflow-hidden rounded-lg bg-gray-800 px-4 py-5 shadow sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">High Scores (≥70)</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-green-400" x-text="stats.high_score_count"></dd>
        </div>

        <!-- Passed Validation -->
        <div class="overflow-hidden rounded-lg bg-gray-800 px-4 py-5 shadow sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">Passed Validation</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-blue-400" x-text="stats.passed_validation"></dd>
        </div>
    </div>

    <!-- Recent Scans -->
    <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-white">
                <i class="fas fa-chart-bar mr-2"></i>
                Recent Scans
            </h2>
            <button @click="loadHistory()" class="text-sm text-blue-400 hover:text-blue-300">
                <i class="fas fa-sync-alt mr-1"></i> Refresh
            </button>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="text-center py-12">
            <i class="fas fa-spinner fa-spin text-4xl text-gray-400"></i>
            <p class="mt-4 text-gray-400">Loading scans...</p>
        </div>

        <!-- Empty State -->
        <div x-show="!loading && history.length === 0" class="text-center py-12">
            <i class="fas fa-search text-4xl text-gray-600 mb-4"></i>
            <p class="text-gray-400">No scans yet. Try scanning a token!</p>
            <a href="/scan" class="mt-4 inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                Scan Token
            </a>
        </div>

        <!-- Scans Table -->
        <div x-show="!loading && history.length > 0" class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead>
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Type</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Time</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Token</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">MoonScore</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Rating</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Validation</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    <template x-for="(scan, index) in history.slice(0, 10)" :key="scan.id">
                        <template>
                            <!-- Main Row -->
                            <tr class="hover:bg-gray-700/50 transition-colors cursor-pointer" @click="toggleExpandedRow(scan.id)">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span x-show="scan.auto_scan" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-400/10 text-purple-400" title="Automatically discovered and scanned">
                                        <i class="fas fa-robot mr-1"></i> AUTO
                                    </span>
                                    <span x-show="!scan.auto_scan" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-400/10 text-gray-400" title="Manually scanned">
                                        <i class="fas fa-hand-pointer mr-1"></i> MANUAL
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="formatTime(scan.timestamp)"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <code class="text-blue-400 font-mono text-xs" x-text="scan.token_address.substring(0, 12) + '...'"></code>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-2xl font-bold" :class="getScoreColor(scan.moon_score)" x-text="scan.moon_score.toFixed(2)"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" x-text="scan.rating"></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                          :class="scan.validation === 'pass' ? 'bg-green-400/10 text-green-400' : 'bg-red-400/10 text-red-400'"
                                          x-text="scan.validation.toUpperCase()">
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <div class="flex items-center gap-2">
                                        <button @click.stop="toggleExpandedRow(scan.id)" class="text-gray-400 hover:text-white">
                                            <i class="fas" :class="expandedRows.includes(scan.id) ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                        </button>
                                        <a :href="`https://solscan.io/token/${scan.token_address}`" target="_blank" 
                                           @click.stop
                                           class="text-blue-400 hover:text-blue-300">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            
                            <!-- Expanded Details Row -->
                            <tr x-show="expandedRows.includes(scan.id)" class="bg-gray-900/50">
                                <td colspan="7" class="px-6 py-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Left Column: Token Info & Metrics -->
                                        <div>
                                            <h4 class="text-lg font-bold text-white mb-4">📊 Token Metrics</h4>
                                            
                                            <!-- Token Info -->
                                            <div class="bg-gray-800 rounded-lg p-4 mb-4">
                                                <div class="grid grid-cols-2 gap-3 text-sm">
                                                    <div>
                                                        <span class="text-gray-400">Symbol:</span>
                                                        <span class="text-white ml-2" x-text="scan.full_data.moon_score.metrics.symbol || 'N/A'"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Name:</span>
                                                        <span class="text-white ml-2" x-text="scan.full_data.moon_score.metrics.name || 'N/A'"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Age:</span>
                                                        <span class="text-white ml-2" x-text="(scan.full_data.moon_score.metrics.age_minutes || 0).toFixed(1) + ' min'"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Price:</span>
                                                        <span class="text-white ml-2" x-text="'$' + (scan.full_data.moon_score.metrics.price_usd || 0).toFixed(8)"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Liquidity:</span>
                                                        <span class="text-white ml-2" x-text="'$' + (scan.full_data.moon_score.metrics.liquidity_usd || 0).toLocaleString()"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Market Cap:</span>
                                                        <span class="text-white ml-2" x-text="'$' + (scan.full_data.moon_score.metrics.market_cap_usd || 0).toLocaleString()"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">24h Volume:</span>
                                                        <span class="text-white ml-2" x-text="'$' + (scan.full_data.moon_score.metrics.volume_24h || 0).toLocaleString()"></span>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-400">Holders:</span>
                                                        <span class="text-white ml-2" x-text="(scan.full_data.moon_score.metrics.total_holders || 0).toLocaleString()"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Score Components -->
                                            <div class="bg-gray-800 rounded-lg p-4">
                                                <h5 class="text-sm font-bold text-white mb-3">Score Breakdown</h5>
                                                <div class="space-y-2 text-xs">
                                                    <template x-for="(value, key) in scan.full_data.moon_score.components" :key="key">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-gray-400" x-text="key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())"></span>
                                                            <div class="flex items-center gap-2">
                                                                <div class="w-24 h-2 bg-gray-700 rounded-full overflow-hidden">
                                                                    <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500" :style="`width: ${value}%`"></div>
                                                                </div>
                                                                <span class="text-white w-12 text-right" x-text="value.toFixed(1)"></span>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Right Column: Validation Rules -->
                                        <div>
                                            <h4 class="text-lg font-bold text-white mb-4">✅ Validation Rules</h4>
                                            <div class="space-y-3">
                                                <template x-for="check in scan.full_data.validation.checks" :key="check.name">
                                                    <div class="bg-gray-800 rounded-lg p-4">
                                                        <div class="flex items-start gap-3">
                                                            <div class="flex-shrink-0 mt-1">
                                                                <i class="fas text-lg" :class="{
                                                                    'fa-check-circle text-green-400': check.status === 'pass',
                                                                    'fa-times-circle text-red-400': check.status === 'fail',
                                                                    'fa-question-circle text-gray-400': check.status === 'unknown'
                                                                }"></i>
                                                            </div>
                                                            <div class="flex-1">
                                                                <div class="flex items-center justify-between mb-1">
                                                                    <h5 class="text-sm font-bold text-white" x-text="check.name"></h5>
                                                                    <span class="text-xs px-2 py-1 rounded-full" 
                                                                          :class="{
                                                                              'bg-red-500/20 text-red-300': check.severity === 'critical',
                                                                              'bg-orange-500/20 text-orange-300': check.severity === 'high',
                                                                              'bg-yellow-500/20 text-yellow-300': check.severity === 'medium',
                                                                              'bg-gray-500/20 text-gray-300': check.severity === 'low'
                                                                          }"
                                                                          x-text="check.severity.toUpperCase()">
                                                                    </span>
                                                                </div>
                                                                <p class="text-xs text-gray-300" x-text="check.message"></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                            
                                            <!-- Summary -->
                                            <div class="mt-4 bg-gray-800 rounded-lg p-4">
                                                <div class="flex items-center justify-between text-sm">
                                                    <span class="text-gray-400">Validation Summary:</span>
                                                    <span class="font-bold" :class="scan.validation === 'pass' ? 'text-green-400' : 'text-red-400'" 
                                                          x-text="scan.full_data.validation.summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Full Token Address -->
                                    <div class="mt-4 bg-gray-800 rounded-lg p-3">
                                        <div class="flex items-center justify-between">
                                            <code class="text-xs text-blue-400 font-mono" x-text="scan.token_address"></code>
                                            <button @click="copyToClipboard(scan.token_address)" class="text-xs text-gray-400 hover:text-white">
                                                <i class="fas fa-copy mr-1"></i> Copy
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </template>
                </tbody>
            </table>
        </div>

        <div x-show="history.length > 10" class="mt-4 text-center">
            <a href="/history" class="text-blue-400 hover:text-blue-300 text-sm">
                View all history <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="bg-gray-800 rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-white mb-4">
            <i class="fas fa-chart-pie mr-2"></i>
            Score Distribution
        </h2>
        <div class="h-64">
            <canvas id="scoreChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function dashboardData() {
    return {
        stats: {
            total_scans: 0,
            average_score: 0,
            high_score_count: 0,
            passed_validation: 0
        },
        autoScannerStatus: {
            running: false,
            discovered_tokens: 0,
            scanned_tokens: 0,
            scan_interval: 300
        },
        manualTokenAddress: '',
        manualScanHours: 2,
        scanningToken: false,
        scanningDiscovery: false,
        expandedRows: [],
        history: [],
        loading: true,
        chart: null,
        
        async init() {
            await this.loadStats();
            await this.loadHistory();
            await this.loadAutoScannerStatus();
            this.initChart();
            
            // Listen for WebSocket updates
            window.addEventListener('scanUpdate', (e) => {
                this.history.unshift(e.detail);
                if (this.history.length > 50) this.history.pop();
                this.loadStats();
                this.updateChart();
            });
            
            // Refresh auto scanner status every 30 seconds
            setInterval(() => this.loadAutoScannerStatus(), 30000);
        },
        
        async loadAutoScannerStatus() {
            try {
                const response = await fetch('/api/auto-scanner/status');
                const data = await response.json();
                if (data.success) {
                    this.autoScannerStatus = data.data;
                }
            } catch (error) {
                console.error('Error loading auto scanner status:', error);
            }
        },
        
        async toggleAutoScanner() {
            try {
                const endpoint = this.autoScannerStatus.running ? '/api/auto-scanner/stop' : '/api/auto-scanner/start';
                const response = await fetch(endpoint, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    window.showToast(data.message, 'success');
                    await this.loadAutoScannerStatus();
                } else {
                    window.showToast('Failed to toggle auto scanner', 'error');
                }
            } catch (error) {
                console.error('Error toggling auto scanner:', error);
                window.showToast('Error: ' + error.message, 'error');
            }
        },
        
        async loadStats() {
            try {
                const response = await fetch('/api/stats');
                const result = await response.json();
                if (result.success) {
                    this.stats = result.data;
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        },
        
        async loadHistory() {
            this.loading = true;
            try {
                const response = await fetch('/api/history?limit=50');
                const result = await response.json();
                if (result.success) {
                    this.history = result.data;
                }
            } catch (error) {
                console.error('Failed to load history:', error);
            } finally {
                this.loading = false;
            }
        },
        
        initChart() {
            const ctx = document.getElementById('scoreChart');
            this.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0-20', '20-40', '40-60', '60-80', '80-100'],
                    datasets: [{
                        label: 'Number of Tokens',
                        data: this.getScoreDistribution(),
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(251, 146, 60, 0.8)',
                            'rgba(250, 204, 21, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#9CA3AF'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#9CA3AF'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#9CA3AF'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });
        },
        
        getScoreDistribution() {
            const ranges = [0, 0, 0, 0, 0];
            this.history.forEach(scan => {
                const score = scan.moon_score;
                if (score < 20) ranges[0]++;
                else if (score < 40) ranges[1]++;
                else if (score < 60) ranges[2]++;
                else if (score < 80) ranges[3]++;
                else ranges[4]++;
            });
            return ranges;
        },
        
        updateChart() {
            if (this.chart) {
                this.chart.data.datasets[0].data = this.getScoreDistribution();
                this.chart.update();
            }
        },
        
        getScoreColor(score) {
            if (score >= 90) return 'text-blue-400';
            if (score >= 80) return 'text-green-400';
            if (score >= 70) return 'text-yellow-400';
            if (score >= 60) return 'text-orange-400';
            return 'text-red-400';
        },
        
        formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            return date.toLocaleDateString();
        },
        
        async scanManualToken() {
            if (!this.manualTokenAddress || this.scanningToken) return;
            
            this.scanningToken = true;
            try {
                window.showToast('Scanning token...', 'info');
                
                const response = await fetch('/api/scan/manual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token_address: this.manualTokenAddress })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    window.showToast('✅ Token scan completed!', 'success');
                    this.manualTokenAddress = '';
                    await this.loadHistory();
                    await this.loadStats();
                } else {
                    window.showToast('❌ Scan failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error scanning token:', error);
                window.showToast('❌ Error: ' + error.message, 'error');
            } finally {
                this.scanningToken = false;
            }
        },
        
        async triggerManualDiscovery() {
            if (this.scanningDiscovery) return;
            
            this.scanningDiscovery = true;
            try {
                window.showToast(`🔍 Discovering tokens from last ${this.manualScanHours} hours...`, 'info');
                
                const response = await fetch('/api/auto-scanner/manual-discovery', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ hours: parseInt(this.manualScanHours) })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const discovered = result.data.discovered_count || 0;
                    const scanned = result.data.scanned_count || 0;
                    window.showToast(`✅ Found ${discovered} tokens, scanned ${scanned}`, 'success');
                    await this.loadHistory();
                    await this.loadStats();
                    await this.loadAutoScannerStatus();
                } else {
                    window.showToast('❌ Discovery failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error triggering discovery:', error);
                window.showToast('❌ Error: ' + error.message, 'error');
            } finally {
                this.scanningDiscovery = false;
            }
        },
        
        toggleExpandedRow(scanId) {
            const index = this.expandedRows.indexOf(scanId);
            if (index > -1) {
                this.expandedRows.splice(index, 1);
            } else {
                this.expandedRows.push(scanId);
            }
        },
        
        copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                window.showToast('Address copied to clipboard!', 'success');
            }).catch(() => {
                window.showToast('Failed to copy', 'error');
            });
        }
    }
}
</script>
{% endblock %}
